\section{Notions of Completeness and Their Preservation Properties}\label{sec:completeness}

In this section we investigate two main questions. The first is how to
define completeness in the context of an internal category. In order
to provide a satisfactory answer, we will want this notion of
completeness to be preserved and reflected by $\family(-)$, so that we
can continue to work with fibrations. Next, we will need to see what
notions equivalences preserve completeness. In particular, many of our
categories will provide only a weak (but sufficient!) notion of
completeness and it is not obvious that it will be preserved by only
internal equivalences.

To begin with, internal categories, like normal categories, give us a
simplistic method of defining finite limits. For instance, products
may be defined as follows.
\begin{defn}\label{defn:completeness:products}
  An internal category $C$ is said to have products if
  $\Delta : C \to C \times C$ has a right adjoint.
\end{defn}
Similarly, the existence of equalizers can be defined by asserting the
existence of a right adjoint of the functor
$C \to C^{\rightrightarrows}$, the internal category of parallel
arrows. The reader may consult~\citet{Jacobs:99} for a more detailed
account of this in Chapter 7. This, moreover, can be seen to be the
right notion of finite limit for externalizations as well.
\begin{thm}\label{defn:completeness:finlimexternalization}
  $\family(C)$ has fiberwise finite limits if and only if $C$ has
  finite limits.
\end{thm}
\begin{proof}
  First let us suppose that $C$ has finite limits and attempt to show
  that $\family(C)$ has them. As is usual for proving the existence of
  finite limits, we simply prove that this property holds for products
  and equalizers.

  First products, suppose that $C$ has products. That is, we know that
  there is an internal functor $p : C \times C \to C$ so that there is
  an internal natural transformation $\eta : 1 \to p \circ \Delta$.
  That is, an external map $\eta : C_0 \to C_1$ sending each object
  $X$ to the diagonal map $X \to X \times X$ internally which
  satisfies the usual universal property; any internal map
  $A \to B \times C$ factors through $\eta_A : A \to A \times A$.

  We then suppose that we have $f, g : I \to C_0$ as objects in
  $\cat{Fam}_I(C)$. We want to show that
  $p_0 \circ \langle f, g \rangle$ is a product. That is, that for any
  $h$,
  \[
    \hom(h, f) \times (h, g) \cong \hom(h, p_0 \circ \langle f, g \rangle)
  \]
  However, since we're in a fiber, we know that $\hom(x, y)$ is
  precisely the same as a morphism $z : I \to C_1$ so that
  $x = \partial_0 \circ z$ and $y = \partial_1 \circ z$, or, put more
  concisely, we have that $z(i) : x(i) \to y(i)$. Therefore, let us
  take the map
  \[
    (x, y) \mapsto m \circ (\eta \partial_0 \circ \pi_1, p_1) \circ \langle x, y \rangle
  \]
  This just sends $x, y$ to $\langle x, y \rangle \circ \eta$
  essentially. We note that be the universal property and the fullness
  of $p$, we know that maps $h(i) \to f(i) \times g(i)$ are in
  bijection with pairs maps $h(i) \to f(i)$ and $h(i) \to g(i)$ as
  required. The case for equalizers is identical.

  We now turn to the reverse direction, suppose that $\family(C)$ has
  fiberwise products, we will show that this implies the existence of
  products in $C$. Suppose that $\family(C)$ has fiberwise limits. We
  wish to exhibit and adjoint $p : C \times C \to C$. First we define
  $p_0 : C_0 \times C_0 \to C_0$. This is done by noting that that we
  have a map $\hom(-, C_0) \times \hom(-, C_0) \to \hom(-, C_0)$
  sending $(f, g) \mapsto f \times g$. Moreover, this is natural
  because products are \emph{split} and reindexing is just
  precomposition. Thus, by Yoneda we have a map
  $p_0 : C_0 \times C_0 \to C_0$. Next we define
  $p_1 : C_1 \times C_1 \to C_1$ by an identical process since maps in
  a fiber of $\cat{Fam}_I(C)$ are equivalent to maps in
  $\hom(I, C_1)$. Furthermore, we have that
  $\partial_i \circ p_1 = p_0 \circ \partial_i$ since
  $y(\partial_i) \circ y(p_1) = y(p_0) \circ y(\partial_i)$ and $y$ is
  faithful. The conditions for $m$ and $i$ are equivalent and rely on
  properties of our natural transformations. It remains to show that
  $\Delta \dashv p$. For this, we must illustrate an
  $\eta : 1 \to p \circ \Delta$ which is appropriately universal. Let
  us consider the family unique map $X \to X \times X$ in
  $\cat{Fam}_{I}(C)$. This map is preserved by reindexing and so is
  natural in $I$. Additionally, this unique map has the type
  $I \to C_1$ and so by instantiating it at $I = C_0$ we get
  $\eta : C_0 \to C_1$ so that
  \[
    \partial_0 \circ \eta = 1 \qquad \partial_1 \circ \eta = p_0
  \]
  as required. Lastly we need to desired universal property. It
  suffices to show that the property holds for every $I$. Therefore,
  suppose that we have a map $f : I \to C_1$
  \[
    f(i) : X(i) \to p_0(A(i), B(i))
  \]
  We wish to show that we can factor $f$ through $\eta$, then the
  Yoneda lemma gives us our desired universality property. For this,
  we note that we have a map in the fiber $\cat{Fam}_I(C)$ between $X$
  and $p \circ \langle A, B \rangle$. By the property the universal
  property of products this factors map factors through
  $X \to p \circ \langle X, X \rangle$. However, we now that this is
  precisely equivalent to factoring through $\eta$ since the diagonal
  is preserved by reindexing.
\end{proof}
Often times the existence of such an adjoint is too strong a
condition. Working internally to a topos, another reasonable approach
would be to state the existence of a limit cone using the internal
language. That is for example,
\begin{defn}\label{defn:completeness:weakproducts}
  An internal category $C$ is said to have weak products if there is
  $Z$ has an epi onto $1$ where $Z$ is defined as
  \[
    Z \triangleq \forall a, b \in C_0.\ \exists c, \pi_1, \pi_2.
    \ \forall d.\ (\exists f_1 f_2.\ f_1 : d \to a \mathrel{\wedge} f_2 : d \to b) \implies
    \exists! g.\ g : c \to d \mathrel{\wedge} \pi_i \circ g = f_i\}
  \]
  Where the proposition
  $f : A \to B \triangleq \partial_0(f) = A \mathrel{\wedge} \partial_1(f) = B$.
\end{defn}
These definitions can be shown to coincide if and only if the topos
satisfies the axiom of choice\footnote{I'm 80\% sure at least} but
since the effective topos does not, we are then left with two
different notions of finite limits. The one based on the existence of
adjoints essentially asserts the global existence of a limit cone and
will be called the \emph{strong} notion of finite limits. The one
based on the internal language is implied by this and is called the
\emph{weak} or \emph{local} version of a finite limit.

We can take this idea to its natural completion and define (weak)
completeness for all small limits.
\begin{defn}\label{defn:complete:complete}
  An internal category $C$ is strongly complete if for all internal
  categories $D$ the diagonal functor $C \to C^D$ has a right
  adjoint.
\end{defn}
\begin{defn}\label{defn:complete:weakcompletebroken}
  An internal category $C$ is weakly complete if for all internal
  categories $D$ the formula specifying an adjoint to the the diagonal
  functor $C \to C^D$ specifies an object with an epi onto $1$.
\end{defn}
We now wish to check that this definition is useful, that is, that it
is preserved and reflected by equivalences. In order to do this, of
course, we must define a notion of equivalence. Again, there are two
reasonable notions. We can assert either the existence of a
pseudo-inverse globally, that is, in the ambient logic, or merely the
existence internally. The former notion is sufficient to determine an
equivalence relation, but the latter does not. It does not, for
instance, satisfy symmetry because of the potential difference between
internal and external existence. Therefore, we need to characterize
the completion of weak equivalences to an equivalence relation.
\begin{defn}\label{defn:complete:weakequivalence}
  Two internal categories, $C$ and $D$, are said to be weakly
  equivalent if there is an third internal category, $E$, so that
  there is a pair weak equivalences, $F : E \to C$ and $G : E \to
  D$. That is, a pair of functors which are internally full, faithful,
  and essentially surjective.
\end{defn}
We wish to generalize the notion of equivalences of internal
categories to equivalences of their fibrations so that we can work
with fibrations in later technical developments. This is done in two
steps, first of all
\begin{thm}\label{thm:complete:equivalencelifts}
  An equivalence of internal categories lifts to a fibered equivalence
  of their externalizations.
\end{thm}
\begin{proof}
\end{proof}
Weak equivalences are more difficult because there isn't a
corresponding notion of existential quantifier at in the metalogic
which corresponds to internal existence. In order to deal with this,
we draw inspiration from Kripke-Joyal semantics where $\exists$ is
modelled with a change of base.
\begin{thm}\label{thm:complete:weakequivalencelifts}
  $F : C \to D$ is a weak equivalence if and only if it lifts to
  $\family(F)$ so that $\family(F)$ is cartesian, full, faithful, and
  for any $X$ in $\cat{Fam}(D)$ there is a $Y \in \cat{Fam}(C)$ so
  that there is an epi $\alpha \in \hom(\family(F)(Y), X)$. so that
  $\alpha^*(X) \cong \family(F)(Y)$.
\end{thm}
\begin{proof}
  First we show that an internal functor lifts to a cartesian functor
  and that an functor between externalizations corresponds to an
  internal functor. For the former, $\family(F)$ can be defined as
  sending
  \[
    \begin{tikzcd}
      I\ar[d, "f"] \\
      C_0
    \end{tikzcd} \longrightarrow
    \begin{tikzcd}
      I\ar[d, "f"] \\
      C_0 \ar[d, "F_0"]\\
      D_0
    \end{tikzcd}
  \]
  The action on morphisms sends
  \[
    \begin{tikzcd}
      I \ar[dd, swap, "f"] \ar[rd, "h"] \ar[rr, "\alpha"] && J \ar[dd, "g"]\\
      & C_1 \ar[dl, swap, "\partial_0"] \ar[dr, "\partial_1"] &\\
      C_0 && C_0
    \end{tikzcd} \longrightarrow
    \begin{tikzcd}
      I \ar[d, swap, "f"] \ar[rd, "h"] \ar[rr, "\alpha"] && J \ar[d, "g"]\\
      C_0 \ar[dd, swap, "F_0"] &
      C_1 \ar[d, "F_1"] \ar[l, swap, "\partial_0"] \ar[r, "\partial_1"] &
      C_0 \ar[dd, "F_0"]\\
      & D_1 \ar[dl, swap, "\partial_0"] \ar[dr, "\partial_1"] &\\
      D_0 && D_0
    \end{tikzcd}
  \]
  We now need to show that this is a cartesian functor. A cartesian
  morphism in $\cat{Fam}(C)$ is one where the diagram of morphisms is
  actually a diagram of isomorphisms. That is, where we in fact have
  the situation
  \[
    \begin{tikzcd}
      I \ar[dd, swap, "f"] \ar[rd, "h"] \ar[rr, "\alpha"] && J \ar[dd, "g"]\\
      & \isos(C) \ar[dl, swap, "\partial_0"] \ar[dr, "\partial_1"] &\\
      C_0 && C_0
    \end{tikzcd}
  \]
  It thus suffices to show that $F_1$ restricts to a map
  $\isos(C) \to \isos(D)$ by the above diagram. This however holds
  because, permitting the internal argument,
  \begin{align*}
    \exists f^{-1}.\ m(f, f^{-1}) = i
    &\iff \exists f^{-1}.\ F_1(m(f, f^{-1})) = i\\
    &\iff \exists f^{-1}.\ m(F_1(f), F(f^{-1})) = i\\
    &\iff \exists f^{-1}.\ m(F_1(f), f^{-1}) = i
  \end{align*}
  Now that we have that $\family(F)$ is cartesian we turn to showing
  that it is faithful if and only if $F$ is. We note that $F$ being
  faithful is equivalent to $F_1$ being a monomorphism which precisely
  tells us that $\family(F)$ is faithful. For the reverse, suppose
  that $\family(F)$ is faithful. Then we wish to show that $F_1$ is a
  mono. We do have that $F_1^* : \hom(-, C_1) \to \hom(-, F_1)$ is a
  faithful functor which is precisely what we need.

  Faithfulness and essential surjectivity are proven in identical ways
  so we focus here on essential surjectivity. Suppose that the formula
  $\forall Y \in D_0.\ \exists X \in C_0.\ F(X) \cong Y$ holds, we
  wish to show that $F$ is internally essentially surjective if and
  only if for any $Y \in \cat{Fam}(D)$ there is an epi $\alpha$ and an
  $X \in \cat{Fam}{C}$ so that $\family(F)(X) \cong \alpha^*(Y)$.
  First the forward direction, suppose that we have a family
  $y : Y \to D_0$. Then, by expanding the definition of ``$F$ is
  internally essentially surjective'' we have that there is an epi
  $\alpha : Z \epi Y$ so that there is a $p : Z \to C_0$ and
  $q : Z \to \isos(D)$ so that $\partial_0 \circ q = F_0 \circ p$ and
  $\partial_1 \circ q = y \circ \alpha$. We now need to show that
  $\family(F)(p) \cong \alpha^*(y)$. However, this follows from the
  commutativity of the diagram
  \[
    \begin{tikzcd}
      Z \ar[d, swap, "p"] \ar[dr, "q"] && Z \ar[d, twoheadrightarrow, "\alpha"]\\
      C_0 \ar[d, swap, "F_0"] & \isos(D) \ar[dl, swap, "\partial_0"] \ar[dr, "\partial_1"] & Y \ar[d, "y"]\\
      D_0 && D_0
    \end{tikzcd}
  \]
  For the reverse, suppose instead that for any $y : Y \to D_0$ we had
  an $\alpha$, $p$ and $q$ so that the following diagram commutes.
  \[
    \begin{tikzcd}
      Z \ar[d, swap, "p"] \ar[dr, "q"] && Z \ar[d, twoheadrightarrow, "\alpha"]\\
      C_0 \ar[d, swap, "F_0"] & \isos(D) \ar[dl, swap, "\partial_0"] \ar[dr, "\partial_1"] & Y \ar[d, "y"]\\
      D_0 && D_0
    \end{tikzcd}
  \]
  We now wish to show that
  $Y \Vdash \exists X.\ \exists f : \isos(C).\ f : X \to y$ holds in
  the internal logic. By the Kripke-Joyal semantics it suffices to
  show that there is a global element of $x : Z \to C_0$ and
  $f : Z \to \isos(D)$ so that $\partial_0 \circ f = x$ and
  $\partial_1 \circ f = y \circ \alpha$. This precisely what we
  supposed however, picking $x = p$ and $f = q$ so we're done.
\end{proof}
Now we turn to the fatal flaw in
Definition~\ref{defn:complete:weakcompletebroken}.
\begin{thm}\label{thm:complete:weakcompletenotpreserved}
  Weak completeness is not preserved by weak equivalences.
\end{thm}
\begin{proof}
  Suppose that we have $C$ weakly equivalent to $C'$ and that $C$ is
  weakly complete, we wish to demonstrate that $C'$ needn't be weakly
  complete. Since $C \equiv C'$, we have an internal functor
  $C \to C'$ and since it's an equivalence it's internally full,
  faithful and essentially surjective. Essential surjectivity implies
  that $C \epi C'$ \todo{Finish}
\end{proof}
This is a major issue, in category theory it is after all a cardinal
sin to not be preserved by isomorphism or equivalence. In this case,
we are in trouble because we will wish to establish the completeness
of one internal category and transfer this to more convenient
categories for semantics. In order to handle this, we will strengthen
our notion of weak completeness to \emph{indexed} diagrams. An indexed
diagram is given in the usual category theoretic style, as a functor
from an internal category in $\Ccat/I$ into $I^*(C)$. Therefore, our
definition of (weak) completeness is simply that an internal category
is (weakly) complete by the previous definition in each slice.
\begin{thm}\label{thm:complete:preservation}
  The following hold
  \begin{enumerate}
  \item Strong equivalences preserve and reflect both strong and weak
    completeness
  \item Weak equivalences preserve and reflect weak completeness
  \end{enumerate}
\end{thm}
\begin{proof}
  \todo{This is tricky but important}
\end{proof}
As a final observation, this notion of completeness has a pleasant
characterization at the level of fibrations.
\begin{thm}\label{thm:complete:completefibration}
  The following hold
  \begin{itemize}
  \item $C$ is complete if $\family(C)$ has fiberwise finite limits and a
    right adjoint to reindexing.
  \item $C$ is weakly complete if $\family(C)$ if given a finite
    diagram in the fiber over $I$, there is a $K \epi I$ so that the
    reindexing of the diagram has a limit over $K$. Similarly, for
    each $u : I \to J$ there is a $e : J \epi K$ so that $(eu)^*$ has
    a right adjoint.
  \end{itemize}
  Furthermore, (weak) equivalences of fibration preserve (weak)
  completeness.
\end{thm}
\begin{proof}
  \todo{Really tricky but very important}
\end{proof}
At this point we have developed all the theory that we need to being
our investigation of what small complete categories exist in the
effective topos.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
